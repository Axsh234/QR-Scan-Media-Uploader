{% extends 'base.html' %}
{% block content %}
<style>
html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: url('https://images.rawpixel.com/image_800/cHJpdmF0ZS9sci9pbWFnZXMvd2Vic2l0ZS8yMDI0LTExL3Jhd3BpeGVsX29mZmljZV8zMF9hYnN0cmFjdF9ncmFkaWVudF93aGl0ZV9iYWNrZ3JvdW5kX3ZlY3Rvcl9wcl9kZGY3ZTJiNC0wMjU3LTRjMTUtOWFjNS0xMmQwZTA0N2E4MWYuanBn.jpg') center/cover no-repeat fixed;
    overflow: hidden;
}

/* Upload container styling */
.upload-wrapper {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100%;
    position: relative;
    z-index: 2;
}
.upload-container {
    background: rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(15px) saturate(180%);
    border-radius: 20px;
    padding: 40px 30px;
    max-width: 400px;
    width: 90%;
    box-shadow: 0 8px 32px rgba(0,0,0,0.25);
    text-align: center;
    color: #111;
    position: relative;
}
.upload-container h2 { margin-bottom: 30px; font-size: 2rem; }
#fileInput { display: none; }
.custom-file-btn { display: inline-block; padding: 12px 20px; background: #00bfff; color: #fff; border-radius: 10px; cursor: pointer; margin: 10px 5px 20px; transition: transform 0.2s ease, background 0.3s; }
.custom-file-btn:hover { transform: scale(1.05); background: #0099cc; }
.upload-container input[type="text"], .upload-btn { width: 100%; padding: 12px 15px; border-radius: 10px; outline: none; font-size: 1rem; border: none; margin-bottom: 20px; }
.upload-btn { background: #00bfff; color: #fff; cursor: pointer; transition: transform 0.2s ease, background 0.3s; position: relative; }
.upload-btn:hover { transform: scale(1.05); background: #0099cc; }

#uploadOverlay { position: absolute; inset: 0; background: rgba(0,0,0,0.5); border-radius: 20px; display: flex; justify-content: center; align-items: center; opacity: 0; pointer-events: none; transition: opacity 0.3s ease; z-index: 5; }
.spinner { border: 6px solid rgba(255,255,255,0.3); border-top: 6px solid #00bfff; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; }
@keyframes spin { 0% { transform: rotate(0deg);} 100% { transform: rotate(360deg);} }

.toast { position: fixed; top: 20px; right: 20px; background: rgba(0,0,0,0.7); color: #fff; padding: 12px 20px; border-radius: 8px; opacity: 0; pointer-events: none; transition: opacity 0.5s ease; z-index: 999; }

/* Floating circles */
.shape {
    position: fixed;
    border-radius: 50%;
    pointer-events: none;
    z-index: 1; /* behind content */
    animation: float linear infinite;
}
@keyframes float {
    0% { transform: translateY(0); }
    100% { transform: translateY(-120vh); }
}
</style>

<div class="upload-wrapper">
    <div class="upload-container">
        <h2>Upload Media</h2>
        <div id="uploadOverlay"><div class="spinner"></div></div>
        <form id="uploadForm" method="POST" enctype="multipart/form-data">
            <label class="custom-file-btn" onclick="document.getElementById('fileInput').click()">Choose Files</label>
            <input id="fileInput" type="file" name="files" accept="image/*,video/*" multiple>
            <ul id="fileList" style="color:#fff; font-weight:600; text-align:left; list-style:none; padding:0;"></ul>
            {% if not current_user.is_authenticated %}
            <input id="uploader_name" type="text" name="uploader_name" placeholder="Your Name (Anonymous if blank)">
            {% endif %}
            <input id="description" type="text" name="description" placeholder="Description (optional)">
            <button type="submit" class="upload-btn">Upload</button>
        </form>
    </div>
</div>

<div class="toast" id="toast">Upload successful!</div>

<script>
// Toast message
function showToast(msg) {
    const toast = document.getElementById('toast');
    toast.textContent = msg;
    toast.style.opacity = 1;
    setTimeout(() => toast.style.opacity = 0, 3000);
}

// Show overlay spinner on submit
document.getElementById('uploadForm').addEventListener('submit', function() {
    document.getElementById('uploadOverlay').style.opacity = 1;
});

// Update file list display
document.getElementById('fileInput').addEventListener('change', function(e) {
    const list = document.getElementById('fileList');
    list.innerHTML = '';
    Array.from(e.target.files).forEach(f => {
        const li = document.createElement('li');
        li.textContent = f.name;
        list.appendChild(li);
    });
});

// Floating circles for full-page background
const circleCount = 50;
for (let i = 0; i < circleCount; i++) {
    const circle = document.createElement('div');
    circle.classList.add('shape');
    const size = 5 + Math.random()*15;
    circle.style.width = `${size}px`;
    circle.style.height = `${size}px`;
    circle.style.left = `${Math.random()*100}%`;
    circle.style.bottom = `-${size}px`;
    circle.style.background = `rgba(255,255,255,${0.2 + Math.random()*0.5})`;
    circle.style.animationDuration = `${5 + Math.random()*10}s`;
    circle.style.animationDelay = `${Math.random()*5}s`;
    document.body.appendChild(circle);
}

// Show Flask flash messages
{% with messages = get_flashed_messages() %}
{% if messages %}
    showToast("{{ messages[0] }}");
{% endif %}
{% endwith %}
</script>
{% endblock %}
